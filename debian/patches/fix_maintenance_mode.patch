From 593608f25ce34eb3e71334c1c569894b94469062 Mon Sep 17 00:00:00 2001
From: Joas Schilling <coding@schilljs.com>
Date: Mon, 25 Jul 2016 09:46:07 +0200
Subject: [PATCH] Make sure we try to autoload the class

---
 lib/private/server.php       | 8 +++++++-
 lib/private/urlgenerator.php | 3 ++-
 2 files changed, 9 insertions(+), 2 deletions(-)

--- a/lib/private/server.php
+++ b/lib/private/server.php
@@ -565,7 +565,13 @@
 			return $factory->getManager();
 		});
 		$this->registerService('ThemingDefaults', function(Server $c) {
-			if($this->getConfig()->getSystemValue('installed', false) && $this->getAppManager()->isInstalled('theming')) {
+			try {
+				$classExists = class_exists('OCA\Theming\Template');
+			} catch (\OCP\AutoloadNotAllowedException $e) {
+				// App disabled or in maintenance mode
+				$classExists = false;
+			}
+			if ($classExists && $this->getConfig()->getSystemValue('installed', false) && $this->getAppManager()->isInstalled('theming')) {
 				return new Template(
 					$this->getConfig(),
 					$this->getL10N('theming'),
